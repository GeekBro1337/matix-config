<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix by Two Points</title>
 <style>
    body {
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
    }
    #settingsPanel {
        width: 300px;
        padding: 10px;
        background-color: #ffffff;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        gap: 15px;
        height: 100%;
        box-sizing: border-box; /* Добавляем для точного расчета ширины */
    }
    #settingsPanel label {
        font-size: 14px;
        margin-bottom: 5px;
    }
    #settingsPanel input, #settingsPanel button, #settingsPanel select {
        width: 100%;
        padding: 8px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box; /* Добавляем для точного расчета ширины */
    }
    #settingsPanel button {
        background-color: #007bff;
        color: white;
        cursor: pointer;
        margin-top: 10px; /* Отступ сверху, чтобы кнопка не была прижата к полям ввода */
    }
    #settingsPanel button:hover {
        background-color: #0056b3;
    }
    #canvasContainer {
        flex-grow: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
    }
    canvas {
        border: 2px solid #333;
        border-radius: 10px;
    }
    #coordinates {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        padding: 5px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
    }
    #coordinates:hover {
        background-color: rgba(0, 0, 0, 0.7);
    }
</style>

</head>
<body>
    <div id="settingsPanel">
        <label for="imageUpload">Upload Image:</label>
        <input type="file" id="imageUpload" accept="image/*">
        
        <label for="pointTopLeft">Top-Left Point (X, Y):</label>
        <input type="text" id="pointTopLeft" placeholder="X: 50, Y: 50">

        <label for="pointBottomRight">Bottom-Right Point (X, Y):</label>
        <input type="text" id="pointBottomRight" placeholder="X: 200, Y: 200">

        <label for="matrixRows">Number of Rows:</label>
        <input type="number" id="matrixRows" placeholder="e.g., 5">

        <label for="matrixCols">Number of Columns:</label>
        <input type="number" id="matrixCols" placeholder="e.g., 5">

        <button id="drawMatrixButton">Draw Matrix</button>

        <label for="colorPicker">Cell Color:</label>
        <input type="color" id="colorPicker" value="#ff0000">
        
        <button id="toggleModeButton">Switch to Paint Mode</button>
    </div>
    <div id="canvasContainer">
        <canvas id="matrixCanvas"></canvas>
        <div id="coordinates">X: 0, Y: 0</div>
    </div>

    <script>
        const canvas = document.getElementById("matrixCanvas");
        const ctx = canvas.getContext("2d");
        let image = null;
        let matrixPoints = [];
        let paintingMode = false; // Начинаем в режиме поиска координат

        // Загрузка изображения
        document.getElementById("imageUpload").addEventListener("change", (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = () => {
                    image = new Image();
                    image.src = reader.result;
                    image.onload = () => {
                        // Устанавливаем размеры канваса в зависимости от изображения
                        canvas.width = image.width;
                        canvas.height = image.height;
                        ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
                    };
                };
                reader.readAsDataURL(file);
            }
        });

        // Обработчик кнопки "Draw Matrix"
        document.getElementById("drawMatrixButton").addEventListener("click", drawMatrix);

        // Обработчик кнопки переключения режима
        document.getElementById("toggleModeButton").addEventListener("click", toggleMode);

        // Функция для рисования матрицы
        function drawMatrix() {
            const topLeft = parsePoint(document.getElementById("pointTopLeft").value);
            const bottomRight = parsePoint(document.getElementById("pointBottomRight").value);

            const rows = parseInt(document.getElementById("matrixRows").value, 10);
            const cols = parseInt(document.getElementById("matrixCols").value, 10);

            if (!topLeft || !bottomRight || isNaN(rows) || isNaN(cols) || rows <= 0 || cols <= 0) {
                alert("Please enter valid points and dimensions.");
                return;
            }

            // Очищаем холст перед рисованием
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Рисуем изображение на холсте
            if (image) {
                ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
            }

            matrixPoints = calculateMatrixPoints(topLeft, bottomRight, rows, cols);
            drawGrid(matrixPoints, rows, cols);
        }

        // Функция для расчёта точек матрицы
        function calculateMatrixPoints(topLeft, bottomRight, rows, cols) {
            const points = [];
            const dx = (bottomRight.x - topLeft.x) / cols;
            const dy = (bottomRight.y - topLeft.y) / rows;

            for (let row = 0; row <= rows; row++) {
                const rowPoints = [];
                for (let col = 0; col <= cols; col++) {
                    rowPoints.push({
                        x: topLeft.x + col * dx,
                        y: topLeft.y + row * dy,
                    });
                }
                points.push(rowPoints);
            }

            return points;
        }

        // Функция для рисования сетки
        function drawGrid(matrixPoints, rows, cols) {
            ctx.strokeStyle = "rgba(0, 0, 0, 0.8)";

            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const topLeft = matrixPoints[row][col];
                    const topRight = matrixPoints[row][col + 1];
                    const bottomLeft = matrixPoints[row + 1][col];
                    const bottomRight = matrixPoints[row + 1][col + 1];

                    ctx.beginPath();
                    ctx.moveTo(topLeft.x, topLeft.y);
                    ctx.lineTo(topRight.x, topRight.y);
                    ctx.lineTo(bottomRight.x, bottomRight.y);
                    ctx.lineTo(bottomLeft.x, bottomLeft.y);
                    ctx.closePath();
                    ctx.stroke();
                }
            }
        }

        // Функция для переключения режима
        function toggleMode() {
            paintingMode = !paintingMode;
            const button = document.getElementById("toggleModeButton");
            button.textContent = paintingMode ? "Switch to Coordinate Mode" : "Switch to Paint Mode";
        }

        // Функция для парсинга ввода координат
        function parsePoint(value) {
            const match = value.match(/X:\s*(\d+),\s*Y:\s*(\d+)/);
            return match ? { x: parseInt(match[1], 10), y: parseInt(match[2], 10) } : null;
        }

        // Функция для отображения координат при клике
        canvas.addEventListener("click", (event) => {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            if (paintingMode) {
                const color = document.getElementById("colorPicker").value;
                paintCell(x, y, color);
            } else {
                const coordDisplay = document.getElementById("coordinates");
                const coordText = `X: ${Math.round(x)}, Y: ${Math.round(y)}`;
                coordDisplay.textContent = coordText;

                // Копирование в буфер обмена
                navigator.clipboard.writeText(coordText)
                    .then(() => {
                        coordDisplay.textContent = `${coordText} (Copied!)`;
                    });
            }
        });

        // Функция для покраски ячейки
        function paintCell(x, y, color) {
            for (let row = 0; row < matrixPoints.length - 1; row++) {
                for (let col = 0; col < matrixPoints[row].length - 1; col++) {
                    const topLeft = matrixPoints[row][col];
                    const bottomRight = matrixPoints[row + 1][col + 1];

                    if (x >= topLeft.x && x <= bottomRight.x && y >= topLeft.y && y <= bottomRight.y) {
                        ctx.fillStyle = color;
                        ctx.fillRect(topLeft.x, topLeft.y, bottomRight.x - topLeft.x, bottomRight.y - topLeft.y);
                    }
                }
            }
        }
    </script>
</body>
</html>
